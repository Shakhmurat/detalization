!function(e,t){function r(){this._thens=[],this._arg=null}var n={addEventListener:function(e,r,n){n=n||t,n.addEventListener?n.addEventListener(e,r,!1):n.attachEvent("on"+e,r)},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"==Object.toString(e)},toArray:function(e){return Array.prototype.slice.call(e)},parseQueryString:function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var a=t[n].split("=",2);r[a[0]]=decodeURIComponent(a[1])}return r},getHostName:function(t){if(!t)return"";var r=e.createElement("a");return r.href=t,r.hostname},each:function(e,t,r){if(e)if(e.length===+e.length){for(var n=0,a=e.length;a>n;n++)if(!1===t.call(r,e[n],n,e))return}else for(var i in e)if(e.hasOwnProperty(i)&&!1===t.call(r,e[i],i,e))return},extend:function(e){return e=e||{},n.each(n.toArray(arguments).slice(1),function(t){n.each(t,function(t,r){e[r]=t})}),e},css:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e.style[r]=t[r])},jsonp:function(r,n,a){function i(){c||(c=!0,d||a(r),o.parentNode.removeChild(o))}var o=e.createElement("script"),d=!1,c=!1,s="callback"+String(Math.random()).slice(2,10);r+=~r.indexOf("?")?"&":"?",r+="callback="+s,t[s]=function(e){c||(t[s]=null,d=!0,n(e))},o.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&(this.onreadystatechange=null,setTimeout(i,0))},o.onload=o.onerror=i,o.src=r;var u=e.getElementsByTagName("head")[0]||e.body;u.appendChild(o)},toParams:function(e){var t,r,n=[],a=function(e,t){var r,n=[];if(t===!0?t="1":t===!1&&(t="0"),"function"==typeof t&&(t=t()),null!==t&&"object"==typeof t){for(r in t)t.hasOwnProperty(r)&&null!==t[r]&&n.push(a(e+"["+r+"]",t[r]));return n.join("&")}if("function"!=typeof t)return encodeURIComponent(e)+"="+encodeURIComponent(t);throw new Error};for(r in e)if(e.hasOwnProperty(r)){t=e[r];var i=a(r,t);i&&n.push(i)}return n.join("&")},setHTML:function(t,r){function n(){return c.replace(/<script/g,'<script data-written="1"')}function i(e){function t(){r||(r=!0,c&&e.insertAdjacentHTML("afterend",n()),o())}var r=!1;e.onreadystatechange=function(){("complete"==this.readyState||"loaded"==this.readyState)&&(this.onreadystatechange=null,setTimeout(t,0))},e.onload=e.onerror=t}function o(){e.write=function(e){c+=e};for(var r=t.getElementsByTagName("script"),a=0;a<r.length;a++){var s=r[a];if(s.getAttribute("data-written")){if("text/rocketscript"===s.type){s.type="text/javascript";var u=s.getAttribute("data-rocketsrc");u&&(s.src=u)}if(!s.type||"text/javascript"==s.type){c="";var l=s.text||s.textContent||s.innerHTML||"",f=e.createElement("script");if(f.type=s.type,f.text=l,s.src&&(f.src=s.src,i(f)),s.parentNode.replaceChild(f,s),f.src)return;if(c){f.insertAdjacentHTML("afterend",n());try{o()}catch(p){console.error(p)}return}}}}e.write=d,t.removeChild(t.firstChild)}if(r){r="<i>&nbsp;</i>"+r,t.innerHTML=r.replace(/<!--script-->/g,"<script").replace(/<!--\/script-->/g,"</script>").replace(/<script/g,'<script data-written="1"');var d=e.write,c="";a.bodyPromise.then(function(){o(t)})}},getOffset:function(r){var n=r.getBoundingClientRect(),a=e.body,i=e.documentElement,o=t.pageYOffset||i.scrollTop||a.scrollTop,d=t.pageXOffset||i.scrollLeft||a.scrollLeft,c=i.clientTop||a.clientTop||0,s=i.clientLeft||a.clientLeft||0,u=n.top+o-c,l=n.left+d-s;return{top:Math.round(u),left:Math.round(l)}},getWindowSize:function(){return{width:t.innerWidth||e.documentElement.clientWidth,height:t.innerHeight||e.documentElement.clientHeight}}};r.prototype={then:function(e,t){this._thens.push({resolve:e,reject:t})},done:function(e){this.then(function(t){e(null,t)},function(t){e(t)})},resolve:function(e){this._complete("resolve",e)},reject:function(e){this._complete("reject",e)},_resolve:function(e){e&&e(this._arg)},_reject:function(e,t){t&&t(this._arg)},_complete:function(e,t){this._arg=t,this.then="resolve"===e?this._resolve:this._reject,this.resolve=this.reject=function(){};for(var r,n=0;r=this._thens[n++];)r[e]&&r[e](t);delete this._thens}};var a={initialized:!1,bodyPromise:new r,uidPromise:new r,places:{},checkBody:function(){e.body?a.bodyPromise.resolve():setTimeout(a.checkBody,1)},guessUid:function(){return t.localStorage?t.postMessage?(n.addEventListener("message",function(e){if(n.getHostName(e.origin)==i.uidHost){var t=e.data.match(/^dumedia-uid=([a-z0-9]*)$/);t&&a.uidPromise.resolve(t[1])}}),void a.uidPromise.resolve("")):void a.uidPromise.reject(new Error("PostMessage is not supported")):void a.uidPromise.reject(new Error("Local Storage is not supported"))},buildTrackParameters:function(r,a,i){if(!r)throw new Error("Client code is not defined");var o="dumediaFirstReferrer",d=0,c="",s=t.localStorage;if(s)try{var u=(e.referrer.split("/")[2]||"").replace(/^www\./,"");c=s.getItem(o)||"";var l=e.location.hostname.replace(/^www\./,"");u&&c!==e.referrer&&u!==l&&(s.setItem(o,e.referrer),c=e.referrer,d=1)}catch(f){}var p={clientCode:r,level:a,fsdt:d};switch(p.level){case"main":break;case"category":var h=i.category||i.ad_category||t.ad_category||null;if(!h)throw new Error("ad_category is not defined");p.id=h;break;case"product":var m=i.product||i.ad_product||t.ad_product||null;if(!m)throw new Error("ad_product is not defined");p.id=m.id;break;case"basket":case"buy":var g=i.products||i.ad_products||t.ad_products||[];if(!n.isArray(g))throw new Error("ad_products is not array");p.id=[],p.cnt=[];for(var v=0;v<g.length;v++)p.id.push(g[v].id),p.cnt.push(g[v].number||1);p.id=p.id.join(","),p.cnt=p.cnt.join(","),p.sum=i.ad_amount||t.ad_amount||0,p.orderId=i.ad_order||t.ad_order||""}return p.sourceDomain=n.getHostName(c),p.url=e.location.href,p.referrer=e.referrer,(i.known_user||i.ad_known_user||t.ad_known_user)&&(p.knownUser=1),p},initTracks:function(){var e=t._dmTrack||[];"object"==typeof t.dumedia&&t.dumedia.code&&e.push(t.dumedia),t._dmTrack=e,e.push=function(){for(var t=0;t<arguments.length;t++)a.track(arguments[t]);Array.prototype.push.apply(e,Array.prototype.slice.call(arguments))};for(var r=0;r<e.length;r++)a.track(e[r])},track:function(t){var r=a.buildTrackParameters(t.code,t.level,t),o=e.createElement("script");o.src="//"+i.trackHost+"/track?"+n.toParams(r),a.uidPromise.done(function(){e.body.appendChild(o)})},loadAd:function(e){if(!e.dumediaInitialized){e.dumediaInitialized=!0;var t=function(){a.showGag(e)};a.uidPromise.done(function(r,o){var d=a.buildAdParams(e,{jsuid:o||""});n.jsonp("//"+i.adHost+"/dmd/prepare?"+n.toParams(d),function(t){t.error?a.showGag(e,t.html):n.setHTML(e,t.html)},t)})}},buildAdParams:function(t,r){var a={};if(t.getAttribute("data-dumedia-extra")){a.extra={};for(var i=t.getAttribute("data-dumedia-extra").split("&"),o=0;o<i.length;o++){var d=i[o].split("=",2);""!==d[0]&&(a.extra[d[0]]=d[1])}}var c=n.getOffset(t),s=n.getWindowSize();return n.extend({},r,{place:t.getAttribute("data-dumedia-adv")||"",siteCode:t.getAttribute("data-dumedia-site")||"",width:t.getAttribute("data-width")||t.offsetWidth,height:t.getAttribute("data-height")||t.offsetHeight,subid:t.getAttribute("data-dumedia-subid")||"",f:top==self?0:1,vw:s.width,vh:s.height,ox:c.left,oy:c.top,rnd:Math.random(),text:t.getAttribute("data-text")||"",ref:e.location.href},a)},findAdElements:function(){var r=t._dmPlaces;if(r){for(var n=0;n<r.length;n++){var i=r[n];"number"==typeof i&&(i={place:i});var o=e.createElement("div");o.setAttribute("data-dumedia-adv",i.place),o.setAttribute("data-dumedia-subid",i.subid||""),e.body.appendChild(o)}t._dmPlaces=[]}for(var d=e.getElementsByTagName("div"),c=[],n=0,s=d.length;s>n;n++){var u=d[n],l=u.getAttribute("data-dumedia-adv"),f=u.getAttribute("data-dumedia-site");(!l&&f||l&&!a.places[l])&&(c.push(u),l&&(a.places[l]=u))}return c},showGag:function(e,t){for(var r=e.getElementsByTagName("script"),a=0;a<r.length;a++){var i=r[a];if("text/x-dumedia-gag"==i.type){t=i.innerHTML;break}}if("function"==typeof e.dumediaGag){var o=e.dumediaGag(t);"string"==typeof o&&(t=o)}t&&n.setHTML(e,t)},updateAd:function(){for(var e=a.findAdElements(),t=0;t<e.length;t++)a.loadAd(e[t])},run:function(){a.initialized||(a.initialized=!0,a.checkBody(),a.bodyPromise.then(a.guessUid),a.initTracks(),a.bodyPromise.then(function(){setInterval(a.updateAd,1e3),a.updateAd()}))}},i={debug:!1,uidHost:"track.dumedia.ru",trackHost:"track.dumedia.ru",adHost:"ad.dumedia.ru"};i=n.extend(i,t.dumedia_config),a.run()}(document,window);